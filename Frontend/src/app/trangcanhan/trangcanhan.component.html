<body>
    <div class="app-container">
        <!-- Main Content -->
        <main class="main-content">
            <!-- Content Panel -->
            <div class="content-panel">
                <!-- Profile View -->
                <div id="profileView" class="page-view" [class.active]="!isEditing">
                    <div class="main-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">H·ªì s∆° ng∆∞·ªùi d√πng</h2>
                            <div class="panel-actions">
                                <button class="btn btn-primary" (click)="onEditClick()">
                                    <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                                        <path
                                            d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                                    </svg>
                                    Ch·ªânh s·ª≠a
                                </button>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="profile-view-grid">
                                <div class="profile-sidebar">
                                    <div class="profile-card-compact">
                                        <div class="profile-avatar-large">
                                            {{ avatarLabel }}
                                            <!-- th·ªÉ hi·ªán ƒë√¢y l√† t√†i kho·∫£n gi·∫£ng vi√™n -->
                                        </div>
                                        <div class="profile-name-large">
                                            {{ profile?.fullName || 'Ch∆∞a c·∫≠p nh·∫≠t' }}
                                        </div>
                                        <div class="profile-code-large">
                                            {{ profile?.username || '-' }}
                                            <!-- ƒë√¢y l√† username c·ªßa ng∆∞·ªùi d√πng -->
                                        </div>
                                        <div class="profile-role-badge-large">
                                            {{ roleBadgeText }}
                                        </div>
                                    </div>
                                    <div class="info-list-compact">
                                        <div class="info-list-title">
                                            Li√™n h·ªá
                                        </div>
                                        <div class="info-item-compact">
                                            <div class="info-item-label">
                                                üìß Email
                                            </div>
                                            <div class="info-item-value">
                                                {{ profile?.email || 'Ch∆∞a c·∫≠p nh·∫≠t' }}
                                            </div>
                                        </div>
                                        <div class="info-item-compact">
                                            <div class="info-item-label">
                                                üì± S·ªë ƒëi·ªán tho·∫°i
                                            </div>
                                            <div class="info-item-value">
                                                {{ profile?.phone || 'Ch∆∞a c·∫≠p nh·∫≠t' }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-sections">
                                    <div class="form-section">
                                        <div class="form-section-title">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                                <path
                                                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                                            </svg>
                                            Th√¥ng tin c∆° b·∫£n
                                        </div>
                                        <div class="form-grid">
                                            <div class="form-group">
                                                <div class="info-item-label">
                                                    H·ªç v√† t√™n
                                                </div>
                                                <div class="info-item-value">
                                                    {{ profile?.fullName || 'Ch∆∞a c·∫≠p nh·∫≠t' }}
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="info-item-label">
                                                    M√£ s·ªë
                                                </div>
                                                <div class="info-item-value">
                                                    {{ userCode }}
                                                </div>


                                            </div>
                                            <div class="form-group">
                                                <div class="info-item-label">
                                                    Ng√†y sinh
                                                </div>
                                                <div class="info-item-value">
                                                    {{
                                                    profile?.birthDate
                                                    ? (profile?.birthDate | date: 'dd/MM/yyyy')
                                                    : 'Ch∆∞a c·∫≠p nh·∫≠t'
                                                    }}
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="info-item-label">
                                                    Gi·ªõi t√≠nh
                                                </div>
                                                <div class="info-item-value">
                                                    {{ formatGender(profile?.gender || null) }}
                                                </div>
                                            </div>
                                            <div class="form-group full-width">
                                                <div class="info-item-label">
                                                    ƒê·ªãa ch·ªâ
                                                </div>
                                                <div class="info-item-value">
                                                    {{ profile?.address || 'Ch∆∞a c·∫≠p nh·∫≠t' }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-section">
                                        <div class="form-section-title">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                                <path
                                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                                            </svg>
                                            Ph√¢n quy·ªÅn h·ªá th·ªëng
                                        </div>
                                        <div class="form-grid">
                                            <div class="form-group">
                                                <div class="info-item-label">
                                                    Vai tr√≤
                                                </div>
                                                <div class="info-item-value">
                                                    {{ roleBadgeText }}
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="info-item-label">
                                                    Tr·∫°ng th√°i
                                                </div>
                                                <div class="info-item-value">
                                                    ‚úÖ ƒêang ho·∫°t ƒë·ªông
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div> <!-- /form-sections -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Edit View -->
                <div id="editView" class="page-view" [class.active]="isEditing">
                    <div class="main-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">C·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n</h2>
                        </div>
                        <div class="panel-body">
                            <form id="editForm" (ngSubmit)="saveChanges()" *ngIf="editModel">
                                <div class="form-sections">
                                    <div class="form-section">
                                        <div class="form-section-title">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                                <path
                                                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                                            </svg>
                                            Th√¥ng tin c∆° b·∫£n
                                        </div>
                                        <div class="form-grid">
                                            <div class="form-group full-width">
                                                <label class="form-label" for="fullName">
                                                    H·ªç v√† t√™n <span class="required">*</span>
                                                </label>
                                                <input type="text" id="fullName" class="form-input"
                                                    [(ngModel)]="editModel.fullName" name="fullName" required />
                                            </div>
                                            <div class="form-group full-width">
                                                <label class="form-label" for="userCode">
                                                    M√£ s·ªë <span class="required">*</span>
                                                </label>
                                                <input type="text" id="userCode" class="form-input"
                                                    [(ngModel)]="editModel.userCode" name="userCode"
                                                    [readonly]="!canEditUserCode" [value]="userCode" />

                                                <small *ngIf="!canEditUserCode" class="hint-text">
                                                    M√£ s·ªë ƒë√£ ƒë∆∞·ª£c g√°n, kh√¥ng th·ªÉ thay ƒë·ªïi.
                                                </small>

                                            </div>
                                            <div class="form-group">
                                                <label class="form-label" for="role">
                                                    Ph√¢n quy·ªÅn <span class="required">*</span>
                                                </label>
                                                <select id="role" class="form-select" [ngModel]="editModel.roleName"
                                                    name="role" disabled required>
                                                    <option value="H·ªçc sinh">üéì Sinh vi√™n</option>
                                                    <option value="Gi·∫£ng vi√™n">üë®‚Äçüè´ Gi·∫£ng vi√™n</option>
                                                    <option value="Admin">üõ°Ô∏è Admin</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label" for="birthDate">
                                                    Ng√†y sinh <span class="required">*</span>
                                                </label>
                                                <input type="date" id="birthDate" class="form-input"
                                                    [(ngModel)]="editModel.birthDate" name="birthDate" required />
                                            </div>
                                            <div class="form-group full-width">
                                                <label class="form-label">
                                                    Gi·ªõi t√≠nh <span class="required">*</span>
                                                </label>
                                                <div class="radio-group">
                                                    <div class="radio-option">
                                                        <input type="radio" id="male" name="gender" class="radio-input"
                                                            [(ngModel)]="editModel.gender" [value]="'Nam'" required />
                                                        <label for="male" class="radio-label">
                                                            üë® Nam
                                                        </label>
                                                    </div>
                                                    <div class="radio-option">
                                                        <input type="radio" id="female" name="gender"
                                                            class="radio-input" [(ngModel)]="editModel.gender"
                                                            [value]="'N·ªØ'" required />
                                                        <label for="female" class="radio-label">
                                                            üë© N·ªØ
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-section">
                                        <div class="form-section-title">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                                <path
                                                    d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
                                            </svg>
                                            Th√¥ng tin li√™n h·ªá
                                        </div>
                                        <div class="form-grid">
                                            <div class="form-group">
                                                <label class="form-label" for="email">
                                                    Email <span class="required">*</span>
                                                </label>
                                                <input type="email" id="email" class="form-input"
                                                    [(ngModel)]="editModel.email" name="email" required />
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label" for="phone">
                                                    S·ªë ƒëi·ªán tho·∫°i <span class="required">*</span>
                                                </label>
                                                <input type="tel" id="phone" class="form-input"
                                                    [(ngModel)]="editModel.phone" name="phone" required />
                                            </div>
                                            <div class="form-group full-width">
                                                <label class="form-label" for="address">
                                                    ƒê·ªãa ch·ªâ <span class="required">*</span>
                                                </label>
                                                <textarea id="address" class="form-textarea"
                                                    [(ngModel)]="editModel.address" name="address" required></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                                    <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
                                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                                            <path
                                                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                                        </svg>
                                        H·ªßy
                                    </button>
                                    <button type="submit" class="btn btn-primary" [disabled]="isSaving">
                                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                                        </svg>
                                        {{ isSaving ? 'ƒêang l∆∞u...' : 'L∆∞u thay ƒë·ªïi' }}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Password View -->
                <div id="passwordView" class="page-view active">
                    <div class="main-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">Thay ƒë·ªïi m·∫≠t kh·∫©u</h2>
                        </div>
                        <div class="panel-body">
                            <form id="passwordForm" #passwordForm="ngForm" (ngSubmit)="changePassword()">
                                <div class="form-sections">
                                    <div class="form-section">
                                        <div class="form-section-title">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                                <path
                                                    d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" />
                                            </svg>
                                            M·∫≠t kh·∫©u m·ªõi
                                        </div>

                                        <div class="form-grid">
                                            <!-- M·∫¨T KH·∫®U HI·ªÜN T·∫†I -->
                                            <div class="form-group full-width">
                                                <label class="form-label" for="currentPassword">
                                                    M·∫≠t kh·∫©u hi·ªán t·∫°i <span class="required">*</span>
                                                </label>

                                                <div class="password-input-wrapper">
                                                    <input [type]="showCurrentPassword ? 'text' : 'password'"
                                                        id="currentPassword" class="form-input"
                                                        placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i"
                                                        [(ngModel)]="passwordModel.currentPassword"
                                                        name="currentPassword" required
                                                        (blur)="onCurrentPasswordBlur()" />

                                                    <!-- N√∫t eye -->
                                                    <button type="button" class="password-eye-btn"
                                                        (click)="togglePasswordVisibility('current')">
                                                        <!-- icon ƒë∆°n gi·∫£n, b·∫°n c√≥ th·ªÉ thay SVG kh√°c -->
                                                        {{ showCurrentPassword ? 'üôà' : 'üëÅ' }}
                                                    </button>

                                                    <!-- Icon check/X -->
                                                    <span class="password-status-icon"
                                                        *ngIf="currentPasswordValid !== null && !currentPasswordChecking"
                                                        [ngClass]="{
                'valid': currentPasswordValid === true,
                'invalid': currentPasswordValid === false
              }">
                                                        {{ currentPasswordValid ? '‚úî' : '‚úñ' }}
                                                    </span>

                                                    <!-- ƒëang ki·ªÉm tra -->
                                                    <span class="password-status-icon checking"
                                                        *ngIf="currentPasswordChecking">
                                                        ...
                                                    </span>
                                                </div>
                                            </div>

                                            <!-- M·∫¨T KH·∫®U M·ªöI -->
                                            <div class="form-group">
                                                <label class="form-label" for="newPassword">
                                                    M·∫≠t kh·∫©u m·ªõi <span class="required">*</span>
                                                </label>

                                                <div class="password-input-wrapper">
                                                    <input [type]="showNewPassword ? 'text' : 'password'"
                                                        id="newPassword" class="form-input"
                                                        placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi"
                                                        [(ngModel)]="passwordModel.newPassword" name="newPassword"
                                                        required minlength="8" />
                                                    <button type="button" class="password-eye-btn"
                                                        (click)="togglePasswordVisibility('new')">
                                                        {{ showNewPassword ? 'üôà' : 'üëÅ' }}
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- X√ÅC NH·∫¨N -->
                                            <div class="form-group">
                                                <label class="form-label" for="confirmPassword">
                                                    X√°c nh·∫≠n m·∫≠t kh·∫©u <span class="required">*</span>
                                                </label>

                                                <div class="password-input-wrapper">
                                                    <input [type]="showConfirmPassword ? 'text' : 'password'"
                                                        id="confirmPassword" class="form-input"
                                                        placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi"
                                                        [(ngModel)]="passwordModel.confirmPassword"
                                                        name="confirmPassword" required minlength="8" />
                                                    <button type="button" class="password-eye-btn"
                                                        (click)="togglePasswordVisibility('confirm')">
                                                        {{ showConfirmPassword ? 'üôà' : 'üëÅ' }}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Kh·ªëi note y√™u c·∫ßu m·∫≠t kh·∫©u gi·ªØ nguy√™n -->
                                        <div
                                            style="background: linear-gradient(135deg, #fef3c7, #fde68a); border-left: 4px solid #f59e0b; padding: 16px 20px; border-radius: 12px; margin-top: 20px;">
                                            <p
                                                style="font-size: 14px; color: #92400e; font-weight: 700; margin-bottom: 10px;">
                                                üîí Y√™u c·∫ßu m·∫≠t kh·∫©u an to√†n:
                                            </p>
                                            <ul style="list-style: none; padding: 0; margin: 0;">
                                                <li
                                                    style="font-size: 13px; color: #78350f; font-weight: 500; margin-bottom: 6px; padding-left: 20px; position: relative;">
                                                    <span
                                                        style="position: absolute; left: 0; color: #f59e0b; font-weight: 700;">‚úì</span>
                                                    T·ªëi thi·ªÉu 8 k√Ω t·ª±
                                                </li>
                                                <li
                                                    style="font-size: 13px; color: #78350f; font-weight: 500; margin-bottom: 6px; padding-left: 20px; position: relative;">
                                                    <span
                                                        style="position: absolute; left: 0; color: #f59e0b; font-weight: 700;">‚úì</span>
                                                    N√™n ch·ª©a ch·ªØ hoa, ch·ªØ th∆∞·ªùng v√† s·ªë
                                                </li>
                                                <li
                                                    style="font-size: 13px; color: #78350f; font-weight: 500; padding-left: 20px; position: relative;">
                                                    <span
                                                        style="position: absolute; left: 0; color: #f59e0b; font-weight: 700;">‚úì</span>
                                                    Kh√¥ng s·ª≠ d·ª•ng th√¥ng tin c√° nh√¢n d·ªÖ ƒëo√°n
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                                    <button type="button" class="btn btn-secondary"
                                        (click)="resetPasswordForm(passwordForm)">
                                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                                            <path
                                                d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z" />
                                        </svg>
                                        ƒê·∫∑t l·∫°i
                                    </button>
                                    <button type="submit" class="btn btn-primary" [disabled]="isChangingPassword">
                                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                                            <path
                                                d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" />
                                        </svg>
                                        {{ isChangingPassword ? 'ƒêang ƒë·ªïi...' : 'ƒê·ªïi m·∫≠t kh·∫©u' }}
                                    </button>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>