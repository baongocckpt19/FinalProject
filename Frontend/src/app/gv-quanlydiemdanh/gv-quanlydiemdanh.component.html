<body>
    <div class="dashboard-container">

        <!-- Main Content -->
        <div class="main-content">

            <!-- Dashboard Content -->
            <div class="dashboard-content">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="page-title-section">
                        <h2 class="page-title">Quản lý điểm danh theo ngày</h2>
                        <p class="page-subtitle">Chọn ngày trên lịch để xem danh sách các lớp có điểm danh</p>
                    </div>

                    <div class="page-actions">
                        <button class="btn btn-outline" onclick="exportAllAttendance()">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                            </svg>
                            Xuất tất cả báo cáo
                        </button>
                        <button class="btn btn-primary" onclick="refreshAllData()">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z" />
                            </svg>
                            Làm mới dữ liệu
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Tổng số lớp học</span>
                            <div class="stat-icon blue">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value">8</div>
                        <div class="stat-change positive">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M7 14l5-5 5 5z" />
                            </svg>
                            <span>Đang quản lý</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Buổi học hôm nay</span>
                            <div class="stat-icon green">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z" />
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value">5</div>
                        <div class="stat-change positive">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M7 14l5-5 5 5z" />
                            </svg>
                            <span>3 đã hoàn thành</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Tỷ lệ điểm danh trung bình</span>
                            <div class="stat-icon orange">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z" />
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value">87%</div>
                        <div class="stat-change positive">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M7 14l5-5 5 5z" />
                            </svg>
                            <span>+2% so với tuần trước</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Cần xem lại</span>
                            <div class="stat-icon red">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" />
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value">2</div>
                        <div class="stat-change negative">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M7 10l5 5 5-5z" />
                            </svg>
                            <span>Lớp có tỷ lệ thấp</span>
                        </div>
                    </div>
                </div>

                <!-- Calendar View -->
                <div class="calendar-section">
                    <div class="calendar-header">
                        <h3 class="calendar-title">Lịch điểm danh tháng {{ currentMonthLabel }}</h3>
                        <div class="calendar-nav">
                            <button class="calendar-nav-btn" (click)="previousMonth()">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                                </svg>
                            </button>
                            <span class="calendar-month">{{ currentMonthLabel }}</span>
                            <button class="calendar-nav-btn" (click)="nextMonth()">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="calendar-grid">
                        <div class="calendar-day-header">CN</div>
                        <div class="calendar-day-header">T2</div>
                        <div class="calendar-day-header">T3</div>
                        <div class="calendar-day-header">T4</div>
                        <div class="calendar-day-header">T5</div>
                        <div class="calendar-day-header">T6</div>
                        <div class="calendar-day-header">T7</div>

                        <!-- Hiển thị ngày -->
                        <ng-container *ngFor="let day of calendarDays">
                            <div class="calendar-day" *ngIf="!day.isEmpty" [class.today]="day.isToday"
                                [class.selected]="day.isSelected" [class.has-attendance]="day.hasAttendance"
                                (click)="selectDate(day.dateStr!)">
                                <div class="day-number">{{ day.dayNumber }}</div>
                                <div class="day-classes">
                                    {{ day.classCount && day.classCount > 0 ? day.classCount + ' lớp' : '' }}
                                </div>
                            </div>

                            <!-- Ô trống đầu tháng -->
                            <div class="calendar-day other-month" *ngIf="day.isEmpty"></div>
                        </ng-container>
                    </div>
                </div>

                <!-- Attendance List -->
                <div class="attendance-list">
                    <div class="attendance-list-header">
                        <h3 class="attendance-list-title">Các lớp điểm danh ngày {{selectedDate}}</h3>
                        <span class="attendance-list-info">4 lớp học</span>
                    </div>

                    <div class="attendance-table-container">
                        <table class="attendance-table">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Lớp học</th>
                                    <th>Thời gian</th>
                                    <th>Trạng thái lớp</th>
                                    <th>Tỷ lệ điểm danh</th>
                                    <th>Có mặt/Tổng số</th>
                                    <th>Vắng mặt</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="cursor: pointer;"
                                    *ngFor="let attendanceClass of attendanceClass, let i = index">
                                    <td>{{i+1}}</td>
                                    <td>
                                        <div class="class-info">

                                            <div class="class-details">
                                                <h5>{{attendanceClass.className}}</h5>
                                                <p>{{attendanceClass.classCode}}</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{attendanceClass.time}}</td>
                                    <td>
                                        <span class="class-status" [ngClass]="{'active': attendanceClass.status === 'Đang hoạt động',
                                                                                'inactive': attendanceClass.status === 'Đã kết thúc',
                                         }">{{attendanceClass.status}}</span>
                                    </td>
                                    
                                    <td>
                                        <span class="attendance-rate" [ngClass]="{
                                                                                'high' : attendanceClass.rate >90,
                                                                                'medium' : attendanceClass.rate <=90 && attendanceClass.rate >=70,
                                                                                'low' : attendanceClass.rate <70
                                        }">{{attendanceClass.rate}}%</span>
                                    </td>
                                    <td><span
                                            class="present-count">{{attendanceClass.present}}/{{attendanceClass.total}}</span>
                                    </td>
                                    <td><span class="absent-count " [ngClass]="{
                                                                                'low' : attendanceClass.absent <=2,
                                                                                'medium' : attendanceClass.absent >2 && attendanceClass.absent <=5,
                                                                                'high' : attendanceClass.absent >5
                                    }">{{attendanceClass.absent}}</span></td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-icon btn-view" title="Xem chi tiết"
                                                (click)="openAttendanceDetailModal(attendanceClass); $event.stopPropagation()">
                                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                                    <path
                                                        d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                                                </svg>
                                            </button>
                                            <button class="btn-icon btn-export" onclick="exportAttendanceReport()"
                                                title="Xuất báo cáo">
                                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                                    <path
                                                        d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                                                </svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                


                <!-- Attendance Detail Section -->
                <div id="attendanceDetailSection" class="attendance-detail-section show"
                    *ngIf="showAttendanceDetailModal">
                    <div class="attendance-list-header">
                        <h3 class="attendance-list-title">Chi tiết điểm danh - <span id="detailClassName"> Lớp
                                {{selectClass.className}}</span></h3>
                        <button class="btn btn-outline" onclick="hideAttendanceDetail()">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                            </svg>
                            Ẩn chi tiết
                        </button>
                    </div>


                    <div class="attendance-table-container">
                        <div style="padding: 32px;">
                            <div class="modal-info-grid">
                                <div class="modal-info-card">
                                    <div class="info-label">Mã lớp</div>
                                    <div class="info-value" id="detailClassCode">IT301</div>
                                </div>
                                <div class="modal-info-card">
                                    <div class="info-label">Thời gian</div>
                                    <div class="info-value" id="detailClassTime">07:30 - 09:30</div>
                                </div>
                                <div class="modal-info-card">
                                    <div class="info-label">Ngày học</div>
                                    <div class="info-value" id="detailClassDate">16/12/2024</div>
                                </div>
                                <div class="modal-info-card">
                                    <div class="info-label">Phòng học</div>
                                    <div class="info-value" id="detailClassRoom">A101</div>
                                </div>
                            </div>

                            <div class="modal-stats">
                                <div class="stat-item">
                                    <div class="stat-number" id="detailTotalStudents">15</div>
                                    <div class="stat-label">Tổng sinh viên</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number present" id="detailPresentStudents">14</div>
                                    <div class="stat-label">Có mặt</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number absent" id="detailAbsentStudents">1</div>
                                    <div class="stat-label">Vắng mặt</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number rate" id="detailAttendanceRate">93%</div>
                                    <div class="stat-label">Tỷ lệ điểm danh</div>
                                </div>
                            </div>

                            <div class="student-list-section">
                                <h4 class="section-title">Danh sách sinh viên</h4>

                                <div class="student-table-container">
                                    <table class="student-table">
                                        <thead>
                                            <tr>
                                                <th>Sinh viên</th>
                                                <th>Trạng thái điểm danh</th>
                                                <th>Giờ điểm danh</th>
                                                <th>Tỷ lệ điểm danh</th>
                                                <th>Số buổi vắng</th>
                                                <th>Thao tác</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let student of students; let i = index;">
                                                <td>
                                                    <div class="student-info">
                                                        <div class="student-details">
                                                            <div class="student-name">{{ student.ho }} {{ student.ten }}
                                                            </div>
                                                            <div class="student-id">{{ student.mssv }}</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <span class="attendance-status" [ngClass]="student.status"
                                                        (click)="toggleStudentStatus(student.id)"
                                                        style="cursor: pointer;" title="Click để đổi trạng thái">
                                                        {{ student.status === 'present' ? 'Có mặt' : 'Vắng mặt' }}
                                                        <!-- hiển thị tiếng Việt -->
                                                    </span>
                                                </td>
                                                <td>{{ student.time || '-' }}</td>

                                                <td><span class="student-rate" [ngClass]="{
                                                    'excellent' : student.rate >90,
                                                    'good' : student.rate <=90 && student.rate >=75,
                                                    'average' : student.rate <75 && student.rate >=50,
                                                    'poor' : student.rate <50 
                                                }">{{student.rate}}%</span></td>

                                                <td><span class="absent-count "
                                                        [ngClass]="{
                                                                                'low' : student.absent <=2,
                                                                                'medium' : student.absent >2 && student.absent <=5,
                                                                                'high' :student.absent >5}">{{student.absent}}</span></td>
                                                <td>

                                                    <div class="action-buttons">
                                                        <button class="btn-icon btn-view"
                                                            (click)="openStudentDetailModal(); $event.stopPropagation()"
                                                            title="Chi tiết sinh viên">
                                                            <svg width="16" height="16" fill="currentColor"
                                                                viewBox="0 0 24 24">
                                                                <path
                                                                    d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.11 3.89 23 5 23H19C20.11 23 21 22.11 21 21V9M19 21H5V3H13V9H19V21Z" />
                                                            </svg>
                                                        </button>
                                                        <button class="btn-icon btn-save"
                                                            onclick="saveStudentAttendance(1)" title="Lưu thay đổi">
                                                            <svg width="16" height="16" fill="currentColor"
                                                                viewBox="0 0 24 24">
                                                                <path
                                                                    d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z" />
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>


                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div
                                style="display: flex; justify-content: flex-end; gap: 12px; padding-top: 24px; border-top: 1px solid rgba(226, 232, 240, 0.3);">
                                <button class="btn btn-primary" onclick="exportDetailReport()">Xuất báo cáo chit
                                    iết</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>




        <!-- Student Detail Modal -->
        <div class="modal active " *ngIf="showStudentDetailModal"> >
             <!-- <div class="modal-overlay" onclick="closeStudentModal()"></div>  -->
            <div class="modal-content" style="max-width: 1000px;">
                <div class="modal-header">
                    <h3 class="modal-title">Chi tiết sinh viên</h3>
                    <button class="modal-close" (click)="closeStudentDetailModal()">
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                        </svg>
                    </button>
                </div>

                <div class="modal-body">
                    <!-- Student Basic Info -->
                    <div class="student-profile-section">
                        <div class="student-profile-header">
                            <div class="student-avatar-large" id="modalStudentAvatar">NV</div>
                            <div class="student-profile-info">
                                <h3 class="student-profile-name" id="modalStudentName">Nguyễn Văn An</h3>
                                <p class="student-profile-id" id="modalStudentId">SV001</p>
                                <div class="student-profile-stats">
                                    <div class="profile-stat">
                                        <span class="profile-stat-label">Email:</span>
                                        <span class="profile-stat-value" >baongock52gmail.com</span>
                                    </div>
                                    <div class="profile-stat">
                                        <span class="profile-stat-label">SĐT:</span>
                                        <span class="profile-stat-value" >0369756152</span>
                                    </div>
                                    <div class="profile-stat">
                                        <span class="profile-stat-label">Lớp:</span>
                                        <span class="profile-stat-value" >IT301</span>
                                    </div>
                                    <div class="profile-stat">
                                        <span class="profile-stat-label">SĐT:</span>
                                        <span class="profile-stat-value" >0369756152</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Attendance Statistics -->
                    <div class="modal-stats">
                        <div class="stat-item">
                            <div class="stat-number" id="modalTotalSessions">30</div>
                            <div class="stat-label">Tổng buổi học</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number present" id="modalPresentSessions">28</div>
                            <div class="stat-label">Có mặt</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number absent" id="modalAbsentSessions">2</div>
                            <div class="stat-label">Vắng mặt</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number rate" id="modalAttendancePercentage">93%</div>
                            <div class="stat-label">Tỷ lệ tham gia</div>
                        </div>
                    </div>

                    <!-- Attendance History -->
                    <div class="attendance-history-section">
                        <h4 class="section-title">Lịch sử điểm danh gần đây</h4>

                        <div class="history-filter">
                            <button class="filter-btn active" onclick="filterHistory('all')">Tất cả</button>
                            <button class="filter-btn" onclick="filterHistory('present')">Có mặt</button>
                            <button class="filter-btn" onclick="filterHistory('absent')">Vắng mặt</button>
                            <button class="filter-btn" onclick="filterHistory('late')">Đi muộn</button>
                        </div>

                        <div class="history-table-container">
                            <table class="history-table">
                                <thead>
                                    <tr>
                                        <th>Ngày</th>
                                        <th>Môn học</th>
                                        <th>Tiết học</th>
                                        <th>Trạng thái</th>
                                        <th>Giờ điểm danh</th>
                                    </tr>
                                </thead>
                                <tbody id="historyTableBody">
                                    <tr>
                                        <td>16/12/2024</td>
                                        <td>Lập trình Web</td>
                                        <td>1-2</td>
                                        <td><span class="attendance-status present">Có mặt</span></td>
                                        <td>07:32</td>
                                     
                                    </tr>
                                    <tr>
                                        <td>13/12/2024</td>
                                        <td>Lập trình Web</td>
                                        <td>1-2</td>
                                        <td><span class="attendance-status present">Có mặt</span></td>
                                        <td>07:28</td>
                                      
                                    </tr>
                                    <tr>
                                        <td>09/12/2024</td>
                                        <td>Lập trình Web</td>
                                        <td>1-2</td>
                                        <td><span class="attendance-status absent">Vắng mặt</span></td>
                                        <td>-</td>
                                      
                                    </tr>
                                    <tr>
                                        <td>06/12/2024</td>
                                        <td>Lập trình Web</td>
                                        <td>1-2</td>
                                        <td><span class="attendance-status present">Có mặt</span></td>
                                        <td>07:45</td>
                                       
                                    </tr>
                                    <tr>
                                        <td>02/12/2024</td>
                                        <td>Lập trình Web</td>
                                        <td>1-2</td>
                                        <td><span class="attendance-status present">Có mặt</span></td>
                                        <td>07:30</td>
                                      
                                    </tr>
                                    <tr>
                                        <td>29/11/2024</td>
                                        <td>Lập trình Web</td>
                                        <td>1-2</td>
                                        <td><span class="attendance-status present">Có mặt</span></td>
                                        <td>07:25</td>
                                     
                                    </tr>
                                    <tr>
                                        <td>25/11/2024</td>
                                        <td>Lập trình Web</td>
                                        <td>1-2</td>
                                        <td><span class="attendance-status absent">Vắng mặt</span></td>
                                        <td>-</td>
                                       
                                    </tr>
                                    <tr>
                                        <td>22/11/2024</td>
                                        <td>Lập trình Web</td>
                                        <td>1-2</td>
                                        <td><span class="attendance-status present">Có mặt</span></td>
                                        <td>07:33</td>
                                g                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-primary" >
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,5.89 21.1,4 20,4Z" />
                        </svg>
                        Xuất báo cáo
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>